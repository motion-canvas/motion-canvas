---
sidebar_position: 2
---

import ReactPlayer from 'react-player'

# Creating an Animation

In this guide, we will start a new Motion Canvas project and create an animation
in it.

### Prerequisites

Make sure that [Node.js](https://nodejs.org/) version 16 or greater is
installed on your machine.

If you're using Motion Canvas as part of the Patreon early access, make sure to
[authenticate to GitHub Packages][autheticate] first.

### Creating a new project

Run the following command in order to scaffold a new Motion Canvas project:

```bash
npm init @motion-canvas
```

Answer the prompts to name your project and select which language you would like
to use, either TypeScript or plain JavaScript.

:::caution

We recommend using TypeScript in your first project, as our Guides use
TypeScript.

:::

### Starting the Motion Canvas App

From your new Motion Canvas project directory, run

```shell
npm run serve
```

This will start the Motion Canvas editor, which you may open by visiting
[http://localhost:9000/](http://localhost:9000/). We will use the editor to
preview our animation, but for now there is nothing to see. To do that, we
must add an element to our scene.

### Programming an animation

The scaffolding command will create several files for you, but for now we're
going to focus on `src/scenes/example.scene.tsx`, which is where we can add our
animations. Open `example.scene.tsx` in a text editor, and replace all code in
the file with the following snippet.

```tsx
import {makeKonvaScene} from '@motion-canvas/core/lib/scenes';
import {Circle} from 'konva/lib/shapes/Circle';
import {useRef} from '@motion-canvas/core/lib/utils';

export default makeKonvaScene(function* example(view) {
  const myCircle = useRef();

  view.add(
    <Circle
      position={{x: -300, y: 0}}
      ref={myCircle}
      width={240}
      height={240}
      fill="#ccc"
    />
  );

  yield* myCircle.value.position({x: 300, y: 0}, 1);
});
```

Now save the file. Any changes you make are automatically picked up and
reflected in the preview. You should see a gray circle in the preview pane at
the top right of the web application. Press the play button to see the circle
animate across the screen.

<ReactPlayer loop controls url='/video/animation.mp4' />

Depending on the size of your browser, you may want to zoom the preview out by
scrolling down on your mouse wheel while hovering over the preview panel.

### Explanation

Motion Canvas is designed to work with different HTML canvas libraries, though
it currently only ships with [Konva](https://konvajs.org/) integration. To
create a new konva scene, we need to call `makeKonvaScene` with a generator
function.

```tsx
// highlight-next-line
import {makeKonvaScene} from '@motion-canvas/core/lib/scenes';

// highlight-next-line
export default makeKonvaScene(function* example(view) {
  // animation code
});
```

The generator function is passed a `view` argument, which we will use to add
components to the scene.

:::tip
If you aren't familiar with generator functions from JavaScript, declared with
`function*`, you can read the MDN documentation on them [here][generators],
though a thorough understanding of them is not necessary to start using Motion
Canvas.
:::

In order to create an animation, we needed something to animate. For that, we
used the Konva Circle component.

```tsx
import {makeKonvaScene} from '@motion-canvas/core/lib/scenes';
// highlight-next-line
import {Circle} from 'konva/lib/shapes/Circle';

export default makeKonvaScene(function* example(view) {
  // highlight-start
  view.add(
    <Circle
      width={240}
      height={240}
      fill="#ccc"
    />
  );
  // highlight-end
});
```

Here we create a new circle instance with `<Circle />` and add it to the scene
using `view.add()`. This code alone will show a gray circle in the middle of the
screen, though it won't move.

To animate the circle, we needed to store a reference to it. This is the purpose
of the `useRef` call.

```tsx
import {makeKonvaScene} from '@motion-canvas/core/lib/scenes';
import {Circle} from 'konva/lib/shapes/Circle';
// highlight-next-line
import {useRef} from '@motion-canvas/core/lib/utils';

export default makeKonvaScene(function* example(view) {
  // highlight-next-line
  const myCircle = useRef();

  view.add(
    <Circle
      // highlight-next-line
      ref={myCircle}
      width={240}
      height={240}
      fill="#ccc"
    />
  );

  // myCircle.value available here
});
```

Once the `Circle` is created with `ref={myCircle}`, it may be accessed from
`myCircle.value`, which we can use to edit the circle's properties. In Konva,
properties are read using `property()`, and written using `property(value)`. To
update the circle's position, for instance, we use

```tsx
myCircle.value.position({x: 300, y: 0});
```

When we edit the properties of a component, however, the changes are immediate.
In order to _transition_ to a new value over time, we must change our call in
two ways. We must specify the duration of the transition in seconds to create an
animation, `position(value, duration)`, and we must `yield*` to the animation.

```tsx
yield* myCircle.value.position({x: 300, y: 0}, 1);
```

The `yield*` is important. Calling `position({...}, 1)` alone will not run the
animation; it simply returns a value called a task, which represents the
animation.

```tsx
const task = myCircle.value.position({x: 300, y: 0}, 1);
```

Yielding a task prompts Motion Canvas to run it.  Using `yield*` waits for the
animation to complete before continuing the scene function, while using `yield`
plays the animation but continues the scene function immediately.

```tsx
yield* myCircle.value.position({x: 300, y: 0}, 1);
// this line will run after the animation has ended
```
```tsx
yield myCircle.value.position({x: 300, y: 0}, 1);
// this line will run immediately while the animation plays
```

In our example, we used `yield*` so that the scene wouldn't end until the
animation was completed.

```tsx
import {makeKonvaScene} from '@motion-canvas/core/lib/scenes';
import {Circle} from 'konva/lib/shapes/Circle';
import {useRef} from '@motion-canvas/core/lib/utils';

// make a new konva scene and pass it the scene function
export default makeKonvaScene(function* example(view) {
  // create a reference to store the circle
  const myCircle = useRef();

  // create a circle and add it to the scene's view
  view.add(
    <Circle
      position={{x: -300, y: 0}} // set an initial position
      ref={myCircle} // assign the circle instance to the myCircle ref
      width={240}
      height={240}
      fill="#ccc"
    />
  );

  // animate to a new position over 1 second and
  // wait for it to finish before continuing
  yield* myCircle.value.position({x: 300, y: 0}, 1);
});
```

[installation]: /guides/getting-started/installation
[generators]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*
[autheticate]: https://github.com/motion-canvas/motion-canvas#authenticate-to-github-packages
